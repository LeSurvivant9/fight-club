services:
  gluetun:
    image: qmcgaw/gluetun
    container_name: gluetun
    networks:
      proxy:
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    ports:
      - "8888:8888/tcp" # HTTP proxy
      - "8388:8388/tcp" # Shadowsocks
      - "8388:8388/udp" # Shadowsocks
      - "61122:61122" # example listening port, check Options -> Login
      - "61123:61123" # example obfuscated port, check Options -> Login
    volumes:
      - /opt/gluetun/appdata:/gluetun
    environment:
      - TZ=${TIMEZONE}
      - VPN_SERVICE_PROVIDER=nordvpn
      - VPN_TYPE=wireguard
      - WIREGUARD_PRIVATE_KEY=${WIREGUARD_KEY}
      - SERVER_COUNTRY=Netherlands
      - UPDATER_PERIOD=24h
    healthcheck:
      test: [ "CMD", "/gluetun-entrypoint", "healthcheck" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    restart: unless-stopped
    labels:
      - "traefik.enable=true"
      - "traefik.docker.network=proxy"
      - "traefik.http.routers.qbittorrent.entrypoints=http"
      - "traefik.http.routers.qbittorrent.rule=Host(`qbittorrent.${DOMAIN}`)"
      - "traefik.http.middlewares.qbittorrent-https-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.qbittorrent.middlewares=qbittorrent-https-redirect"
      - "traefik.http.routers.qbittorrent-secure.entrypoints=https"
      - "traefik.http.routers.qbittorrent-secure.rule=Host(`qbittorrent.${DOMAIN}`)"
      - "traefik.http.routers.qbittorrent-secure.tls=true"
      - "traefik.http.routers.qbittorrent-secure.tls.certresolver=cloudflare"
      - "traefik.http.routers.qbittorrent-secure.service=qbittorrent"
      - "traefik.http.services.qbittorrent.loadbalancer.server.port=8081"

      - "traefik.http.routers.soulseek.entrypoints=http"
      - "traefik.http.routers.soulseek.rule=Host(`soulseek.${DOMAIN}`)"
      - "traefik.http.middlewares.soulseek-https-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.soulseek.middlewares=soulseek-https-redirect"
      - "traefik.http.routers.soulseek-secure.entrypoints=https"
      - "traefik.http.routers.soulseek-secure.rule=Host(`soulseek.${DOMAIN}`)"
      - "traefik.http.routers.soulseek-secure.tls=true"
      - "traefik.http.routers.soulseek-secure.tls.certresolver=cloudflare"
      - "traefik.http.routers.soulseek-secure.service=soulseek"
      - "traefik.http.services.soulseek.loadbalancer.server.port=6080"

      - diun.enable=true

networks:
  proxy:
    external: true
