---
services:
  freshrss:
    extends:
      file: ../common.yml
      service: common-config
    image: freshrss/freshrss:latest
    container_name: freshrss
    hostname: freshrss
    environment:
      - CRON_MIN=${CRON_MIN}
      - TRUSTED_PROXY=${TRUSTED_PROXY}
    networks:
      - proxy
    volumes:
      - /opt/freshrss/data:/var/www/FreshRSS/data
      - /opt/freshrss/extensions:/var/www/FreshRSS/extensions
    healthcheck:
      test: [CMD, cli/health.php]
      timeout: 10s
      start_period: 60s
      start_interval: 11s
      interval: 75s
      retries: 3
    labels:
      - traefik.enable=true
      - traefik.docker.network=proxy
      - traefik.http.routers.freshrss-secure.entrypoints=https
      - traefik.http.routers.freshrss-secure.rule=Host(`freshrss.${DOMAIN}`)
      - traefik.http.routers.freshrss-secure.tls=true
      - traefik.http.routers.freshrss-secure.tls.certresolver=cloudflare
      - traefik.http.routers.freshrss-secure.service=freshrss
      - traefik.http.services.freshrss.loadbalancer.server.port=80
    mem_limit: 256M
    logging:
      options:
        max-size: 10m
networks:
  proxy:
    external: true
